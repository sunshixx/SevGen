<?xml version="1.0" encoding="UTF-8"?>
<svg width="1180" height="420" viewBox="0 0 1180 420" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#E8F5E9"/>
      <stop offset="100%" stop-color="#FFFFFF"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.2"/>
    </filter>
    <style>
      .title{font:700 18px 'Segoe UI', Arial; fill:#1B5E20}
      .lane{font:600 14px 'Segoe UI', Arial; fill:#37474F}
      .label{font:500 13px 'Segoe UI', Arial; fill:#263238}
      .note{font:500 12px 'Segoe UI', Arial; fill:#546E7A}
    </style>
  </defs>

  <rect x="0" y="0" width="1180" height="420" fill="url(#bg)"/>
  <text x="590" y="28" text-anchor="middle" class="title">单角色对话流程（Single Chat Sequence）</text>

  <!-- Swimlanes -->
  <g>
    <rect x="70" y="50" width="240" height="330" rx="10" ry="10" fill="#FFFFFF" stroke="#B0BEC5" filter="url(#shadow)"/>
    <text x="190" y="72" text-anchor="middle" class="lane">User</text>
    <line x1="190" y1="90" x2="190" y2="360" stroke="#CFD8DC" stroke-width="2" stroke-dasharray="6 6"/>

    <rect x="360" y="50" width="240" height="330" rx="10" ry="10" fill="#FFFFFF" stroke="#B0BEC5" filter="url(#shadow)"/>
    <text x="480" y="72" text-anchor="middle" class="lane">Frontend</text>
    <line x1="480" y1="90" x2="480" y2="360" stroke="#CFD8DC" stroke-width="2" stroke-dasharray="6 6"/>

    <rect x="650" y="50" width="240" height="330" rx="10" ry="10" fill="#FFFFFF" stroke="#B0BEC5" filter="url(#shadow)"/>
    <text x="770" y="72" text-anchor="middle" class="lane">Backend</text>
    <line x1="770" y1="90" x2="770" y2="360" stroke="#CFD8DC" stroke-width="2" stroke-dasharray="6 6"/>

    <rect x="940" y="50" width="170" height="330" rx="10" ry="10" fill="#FFFFFF" stroke="#B0BEC5" filter="url(#shadow)"/>
    <text x="1025" y="72" text-anchor="middle" class="lane">AI / RAG</text>
    <line x1="1025" y1="90" x2="1025" y2="360" stroke="#CFD8DC" stroke-width="2" stroke-dasharray="6 6"/>
  </g>

  <!-- Arrows -->
  <g>
    <defs>
      <marker id="arrBlue" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#1976D2"/>
      </marker>
      <marker id="arrGreen" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#00796B"/>
      </marker>
      <marker id="arrAmber" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#F9A825"/>
      </marker>
    </defs>

    <path d="M190,110 C335,110 335,110 480,110" stroke="#1976D2" stroke-width="2" fill="none" marker-end="url(#arrBlue)"/>
    <text x="335" y="100" text-anchor="middle" class="label">输入消息</text>

    <path d="M480,140 C625,140 625,140 770,140" stroke="#00796B" stroke-width="2" fill="none" marker-end="url(#arrGreen)"/>
    <text x="625" y="130" text-anchor="middle" class="label">POST /api/chat/messages</text>

    <path d="M770,170 C895,170 895,170 1025,170" stroke="#00796B" stroke-width="2" fill="none" marker-end="url(#arrGreen)"/>
    <text x="910" y="160" text-anchor="middle" class="label">构造提示词 + 检索 RAG + 反思约束</text>

    <path d="M1025,200 C895,200 895,200 770,200" stroke="#00796B" stroke-width="2" fill="none" marker-end="url(#arrGreen)"/>
    <text x="910" y="190" text-anchor="middle" class="label">生成回复（流式）</text>

    <path d="M770,230 C625,230 625,230 480,230" stroke="#F9A825" stroke-width="2" fill="none" marker-end="url(#arrAmber)"/>
    <text x="625" y="220" text-anchor="middle" class="label">SSE 流式传输</text>

    <path d="M480,260 C335,260 335,260 190,260" stroke="#1976D2" stroke-width="2" fill="none" marker-end="url(#arrBlue)"/>
    <text x="335" y="250" text-anchor="middle" class="label">打字机效果渲染</text>
  </g>
</svg>
